services:
  - type: web
    name: selenium-bot
    env: python
    plan: free
    buildCommand: |
      # Install system dependencies
      apt-get update && apt-get install -y \
          wget \
          unzip \
          libnss3 \
          libatk-bridge2.0-0 \
          libdrm2 \
          libxkbcommon0 \
          libxcomposite1 \
          libxdamage1 \
          libxrandr2 \
          libgbm1 \
          libxss1 \
          libasound2

      # Install Python packages (webdriver-manager will handle Chrome/Chromium)
      pip install --upgrade pip
      pip install -r requirements.txt

      # Download VPN extensions (optional)
      mkdir -p extensions
      wget -q -O extensions/touch_vpn.crx "https://clients2.google.com/service/update2/crx?response=redirect&prodversion=109.0&x=id%3Dbihmplhobchoageeokmgbdihknkjbknd%26installsource%3Dwebstore%26uc" || echo "VPN download failed"
      wget -q -O extensions/hotspot_shield.crx "https://clients2.google.com/service/update2/crx?response=redirect&prodversion=109.0&x=id%3Dnlbejmccbhkncgokjcmghpfloaajcffj%26installsource%3Dwebstore%26uc" || echo "VPN download failed"
    startCommand: python bot.py
    envVars:
      - key: RENDER
        value: true
      - key: FLASK_ENV
        value: production
